#include <NTPClient.h>
#include <ESP8266WiFi.h>
#include <WiFiUdp.h>
#include <Arduino.h>
#include <TM1637Display.h>
#include "IRDate.h"
IRDate ir;//or IRDate ir(time zone , DaylightSavingTime ON or OFF)
#define led 16
#define CLK 14
#define DIO 12
TM1637Display display(CLK, DIO);


const char *ssid     = "reza";
const char *password = "@pi#3.14!!";

WiFiUDP ntpUDP;
NTPClient timeClient(ntpUDP, "europe.pool.ntp.org",0, 60000);

void setup(){
  pinMode(led,OUTPUT);
  digitalWrite(led,1);
  Serial.begin(115200);
  WiFi.begin(ssid, password);
  while ( WiFi.status() != WL_CONNECTED ) {
    delay ( 500 );
    Serial.print ( "." );
  }

  timeClient.begin();
  timeClient.update();
  if(timeClient.getEpochTime()<100){
    digitalWrite(led,0);
    delay(1000);
    Serial.println("No access to NTP pool.");
    while(1);
  }
  
  display.setBrightness(1);
  delay(500);
  Serial.println();
  Serial.println("**********************");
  Serial.println(ir.jalaliToEpoch(1396,1,3,1,25,32,IR,DLST_ON));
  Serial.println("--------");
  Serial.println(ir.jalaliToEpoch("1396-01-03","01:25:32",IR));
  Serial.println(ir.jalaliToEpoch("1396-01-03","01:25:32"));
  Serial.println(ir.timeFormat(1490216132));
  Serial.println(ir.dateFormat(1490216132));  
  Serial.println("**********************");
  
  Serial.println();
}

uint32_t ptime=0;
bool flag=0;
void loop() {
  if((millis()-ptime)>999){
    ptime=millis();
    Serial.println(ir.timeFormat(timeClient.getEpochTime()));
    Serial.println(ir.dateFormat(timeClient.getEpochTime()));
    Serial.println(timeClient.getEpochTime());
    Serial.println();
    int HH=ir.hour(timeClient.getEpochTime());
    int MM=ir.minute(timeClient.getEpochTime());
    display.showNumberDecEx(HH*100+MM,(0x80>>(flag)),1);
    flag=!flag;
    
  }
}
